# Discord.js E-Learning System 仕様書

## 1. システム概要

### 1.1 目的
Discord.jsを使用したBot開発の楽しさを初心者に体験してもらうためのe-ラーニングシステム。「コードを書いて動く楽しみ」を最初に味わえることを最優先とし、環境構築の障壁を取り除く。

### 1.2 主要コンセプト
- **即座に動作確認可能**: サンドボックス環境で書いたコードがすぐに動く
- **段階的学習**: 環境構築は後回しにし、まずはコーディングの楽しさを体験
- **共有リソース**: 初期段階では共有Botアカウントとトークンを使用
- **安全な実験環境**: 失敗を恐れずに試せるサンドボックス

## 2. システムアーキテクチャ

### 2.1 全体構成
```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│  Webフロントエンド  │────▶│   APIサーバー      │────▶│ Discordサーバー   │
│  (React/Vue.js)  │     │  (Node.js)        │     │  (学習用)        │
└─────────────────┘     └──────────────────┘     └─────────────────┘
         │                       │
         └───────────┬───────────┘
                     ▼
              ┌─────────────┐
              │ サンドボックス  │
              │  実行環境     │
              └─────────────┘
```

### 2.2 主要コンポーネント

#### Webフロントエンド
- **コードエディタ**: Monaco Editor（VS Code風）
- **実行結果表示**: リアルタイムログ表示
- **チュートリアル表示**: ステップバイステップガイド
- **進捗管理**: 学習進度の可視化

#### APIサーバー
- **認証・セッション管理**: 学習者の識別
- **コード実行管理**: サンドボックスへのコード送信
- **進捗記録**: 学習履歴の保存
- **リソース管理**: 実行時間・回数の制限

#### サンドボックス実行環境
- **隔離実行**: Docker/VMによる安全な実行環境
- **共有Bot管理**: 単一Botインスタンスの多重化
- **リソース制限**: CPU/メモリ/実行時間の制限
- **ログ収集**: 実行結果のストリーミング

## 3. カリキュラム構成

### 3.1 学習フロー

#### 第1章: はじめてのDiscord Bot（サンドボックス環境）
1. **Hello, Discord!** - 最初のメッセージ送信
2. **コマンドに反応する** - 簡単なコマンド作成
3. **リアクションを追加** - 絵文字リアクション
4. **埋め込みメッセージ** - リッチなメッセージ作成
5. **ボタンとインタラクション** - インタラクティブな要素

#### 第2章: より高度な機能（サンドボックス環境）
1. **スラッシュコマンド** - モダンなコマンド実装
2. **音声チャンネル** - 音声機能の基礎
3. **データの保存** - 簡単なデータ永続化
4. **タイマーとスケジュール** - 定期実行処理

#### 第3章: 自分のBotを作る（環境構築）
1. **Discord Developer Portalの使い方**
2. **Botアカウントの作成とトークン取得**
3. **Botの招待とサーバー設定**
4. **ローカル開発環境の構築**
5. **デプロイメントの基礎**

### 3.2 各レッスンの構成
```yaml
レッスン:
  タイトル: "Hello, Discord!"
  目標: "Botから最初のメッセージを送信する"
  説明: |
    Discord Botの基本的な仕組みを理解し、
    チャンネルにメッセージを送信してみましょう。
  
  ステップ:
    - タイトル: "クライアントの作成"
      説明: "Discord.jsのClientオブジェクトを作成します"
      ヒント: "new Discord.Client()を使います"
      初期コード: |
        const { Client, GatewayIntentBits } = require('discord.js');
        // ここにコードを書いてください
      
    - タイトル: "Botのログイン"
      説明: "提供されたトークンでログインします"
      検証: "readyイベントが発火すること"
  
  チャレンジ:
    - "異なる絵文字を含むメッセージを送信"
    - "ランダムな挨拶を送信"
```

## 4. サンドボックス環境仕様

### 4.1 実行環境
- **Node.js**: v18.x LTS
- **discord.js**: v14.x（最新安定版）
- **実行時間制限**: 30秒/実行
- **メモリ制限**: 256MB
- **同時実行数**: 1人1プロセスまで

### 4.2 セキュリティ対策
- **ネットワーク制限**: Discord APIのみ許可
- **ファイルシステム**: 読み取り専用（一時ファイルのみ書き込み可）
- **プロセス生成**: 禁止
- **危険なモジュール**: ブラックリスト制御

### 4.3 共有Botの多重化
```javascript
// 仮想チャンネルマッピング
userSessions = {
  "user123": {
    virtualChannelId: "virtual_123",
    realChannelId: "real_sandbox_channel",
    messagePrefix: "[User123]"
  }
}

// メッセージ送信時の処理
bot.on('messageCreate', (message) => {
  const session = getUserSession(message.author.id);
  if (session && message.channel.id === session.realChannelId) {
    // 仮想チャンネルIDに変換して学習者に表示
    forwardToUser(session.userId, {
      ...message,
      channelId: session.virtualChannelId
    });
  }
});
```

## 5. ユーザーインターフェース

### 5.1 画面構成
```
┌──────────────────────────────────────────────────┐
│  [ロゴ]  Discord.js Learning    [進捗: 25%] [👤]  │
├──────────────┬───────────────────────────────────┤
│              │                                   │
│  レッスン一覧  │        コードエディタ              │
│              │                                   │
│  ▼ 第1章     │  const client = new Client();    │
│    ✓ Hello   │  client.on('ready', () => {      │
│    ▶ コマンド  │    console.log('Bot is ready!'); │
│    ○ リアクション│  });                            │
│              │                                   │
├──────────────┼───────────────────────────────────┤
│              │  実行結果 / Discordプレビュー       │
│   説明・ヒント  │  [実行] [リセット] [次へ]         │
│              │  > Bot is ready!                  │
│              │  > Message sent to #general       │
└──────────────┴───────────────────────────────────┘
```

### 5.2 主要機能
- **自動保存**: 入力内容の自動保存
- **構文ハイライト**: JavaScript/TypeScript対応
- **インテリセンス**: discord.jsのAPI補完
- **エラー表示**: わかりやすいエラーメッセージ
- **実行履歴**: 過去の実行結果の確認

## 6. 技術スタック

### 6.1 フロントエンド
- **フレームワーク**: React 18 or Vue 3
- **エディタ**: Monaco Editor
- **UI**: Material-UI or Ant Design
- **状態管理**: Redux/Zustand or Pinia
- **通信**: Socket.io（リアルタイム更新）

### 6.2 バックエンド
- **フレームワーク**: Express.js or Fastify
- **認証**: JWT + Session
- **データベース**: PostgreSQL（ユーザー進捗）
- **キュー**: Bull（実行タスク管理）

### 6.3 インフラ
- **コンテナ**: Docker

## 7. 今後の拡張計画

### Phase 1（初期リリース）
- 基本的なサンドボックス環境
- 第1章のレッスン
- 最小限のUI

### Phase 2（3ヶ月後）
- 第2章の追加
- コード共有機能
- 成績証明書発行

### Phase 3（6ヶ月後）
- 第3章（環境構築）の追加
- コミュニティ機能
- 上級者向けコース

### Phase 4（1年後）
- TypeScript対応
- プラグイン開発講座
- 企業向けプラン

---

本仕様書は初版であり、開発過程で随時更新される予定です。